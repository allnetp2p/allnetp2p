(()=>{"use strict";var e={742:(e,r)=>{r.b$=function(e){var r,t,n=function(e){var r=e.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=e.indexOf("=");return-1===t&&(t=r),[t,t===r?0:4-t%4]}(e),s=n[0],i=n[1],c=new a(function(e,r,t){return 3*(r+t)/4-t}(0,s,i)),l=0,u=i>0?s-4:s;for(t=0;t<u;t+=4)r=o[e.charCodeAt(t)]<<18|o[e.charCodeAt(t+1)]<<12|o[e.charCodeAt(t+2)]<<6|o[e.charCodeAt(t+3)],c[l++]=r>>16&255,c[l++]=r>>8&255,c[l++]=255&r;return 2===i&&(r=o[e.charCodeAt(t)]<<2|o[e.charCodeAt(t+1)]>>4,c[l++]=255&r),1===i&&(r=o[e.charCodeAt(t)]<<10|o[e.charCodeAt(t+1)]<<4|o[e.charCodeAt(t+2)]>>2,c[l++]=r>>8&255,c[l++]=255&r),c},r.JQ=function(e){for(var r,o=e.length,a=o%3,n=[],s=16383,i=0,l=o-a;i<l;i+=s)n.push(c(e,i,i+s>l?l:i+s));return 1===a?(r=e[o-1],n.push(t[r>>2]+t[r<<4&63]+"==")):2===a&&(r=(e[o-2]<<8)+e[o-1],n.push(t[r>>10]+t[r>>4&63]+t[r<<2&63]+"=")),n.join("")};for(var t=[],o=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,i=n.length;s<i;++s)t[s]=n[s],o[n.charCodeAt(s)]=s;function c(e,r,o){for(var a,n,s=[],i=r;i<o;i+=3)a=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),s.push(t[(n=a)>>18&63]+t[n>>12&63]+t[n>>6&63]+t[63&n]);return s.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},500:e=>{e.exports='(()=>{"use strict";class s{constructor(){this.prefix="test-prefix"}handle(s){postMessage({prefix:this.prefix,gotMessage:s})}}(()=>{const e=new s;onmessage=s=>{e.handle(s.data)}})()})();'}},r={};function t(o){var a=r[o];if(void 0!==a)return a.exports;var n=r[o]={exports:{}};return e[o](n,n.exports,t),n.exports}(()=>{var e=t(742);function r(e){return new Promise(((r,t)=>{e.oncomplete=e.onsuccess=()=>r(e.result),e.onabort=e.onerror=()=>t(e.error)}))}let o;function a(){return o||(o=function(e,t){const o=(!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(e){var r=function(){return indexedDB.databases().finally(e)};a=setInterval(r,100),r()})).finally((function(){return clearInterval(a)})):Promise.resolve()).then((()=>{const e=indexedDB.open("keyval-store");return e.onupgradeneeded=()=>e.result.createObjectStore(t),r(e)}));var a;return(e,r)=>o.then((o=>r(o.transaction(t,e).objectStore(t))))}(0,"keyval")),o}var n=t(500);(async()=>{console.log("@@-loader-@@ - broker source: ",n);const t=new Blob([n],{type:"application/javascript"});console.log("@@-loader-@@ - broker blob: ",t);const o=URL.createObjectURL(t);console.log("@@-loader-@@ - broker url: ",o);const s=new Worker(o);URL.revokeObjectURL(o),console.log("@@-loader-@@ - broker worker: ",s),s.onmessage=e=>{console.log("@@-loader-@@ - broker message: ",e.data)},s.postMessage("test-message-from-an-loader");const i=await async function(){const e=(new TextEncoder).encode("passphrase");console.log("@@-loader-@@ - passphraseRaw: ",e);const r=await crypto.subtle.importKey("raw",e.buffer,"PBKDF2",!1,["deriveKey"]);return console.log("@@-loader-@@ - passphrase: ",r),r}(),c=await async function(t){const o="P-384",n=await(async()=>{try{return await function(e,t=a()){return t("readonly",(t=>r(t.get(e))))}("signKeypair")}catch{return null}})();if(!n)return console.log("@@-loader-@@ - no keypair in db, GENERATING NEW"),await async function(t){const o="SHA-512",n=2e5,s=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-384"},!0,["sign","verify"]);console.log("@@-loader-@@ - signKeypair: ",s);const i=crypto.getRandomValues(new Uint8Array(24)),c=Date.now(),l=await crypto.subtle.deriveKey({name:"PBKDF2",hash:o,salt:i,iterations:n},t,{name:"AES-GCM",length:256},!1,["wrapKey","unwrapKey"]),u=Date.now();console.log("@@-loader-@@ - secretKey (in",u-c,"ms): ",l);const p=crypto.getRandomValues(new Uint8Array(24)),d=await crypto.subtle.wrapKey("jwk",s.privateKey,l,{name:"AES-GCM",iv:p,tagLength:128});console.log("@@-loader-@@ - savePrivKey: ",d);const y=await crypto.subtle.exportKey("jwk",s.publicKey);console.log("@@-loader-@@ - savePubKey: ",y);const g={pbkdf2HashAlgo:o,pbkdf2Iterations:n,pbkdf2Salt:e.JQ(i),aesGcmIv:e.JQ(p),privateKey:e.JQ(new Uint8Array(d)),publicKey:y};return console.log("@@-loader-@@ - signKeypairEnc: ",g),await function(e,t,o=a()){return o("readwrite",(o=>(o.put(t,e),r(o.transaction))))}("signKeypair",g),{privateKey:s.privateKey,publicKey:s.publicKey,publicKeyJwt:g.publicKey}}(t);console.log("@@-loader-@@ - loaded stored keypair: ",n);const s=e.b$(n.pbkdf2Salt),i=Date.now(),c=await crypto.subtle.deriveKey({name:"PBKDF2",hash:n.pbkdf2HashAlgo,salt:s,iterations:n.pbkdf2Iterations},t,{name:"AES-GCM",length:256},!1,["wrapKey","unwrapKey"]),l=Date.now();console.log("@@-loader-@@ - secretKey (in",l-i,"ms): ",c);const u=e.b$(n.aesGcmIv),p=await crypto.subtle.unwrapKey("jwk",e.b$(n.privateKey),c,{name:"AES-GCM",iv:u,tagLength:128},{name:"ECDSA",namedCurve:o},!0,["sign"]);console.log("@@-loader-@@ - signPrivKey: ",p);return{privateKey:p,publicKey:await crypto.subtle.importKey("jwk",n.publicKey,{name:"ECDSA",namedCurve:o},!0,["verify"]),publicKeyJwt:n.publicKey}}(i);console.log("SIGN KEYPAIR IDENTITY",c)})().then((()=>{}),(e=>{console.error(e)}))})()})();